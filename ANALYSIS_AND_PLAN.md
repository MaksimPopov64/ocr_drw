# Анализ приложения OCR и План Рефакторинга

## 1. Обнаруженные Проблемы

### Критические ошибки в коде
1. **Несоответствие имен классов**:
   - В файле `app.py` происходит импорт: `from mistral_processor import MistralOCRProcessor`.
   - Однако в файле `mistral_processor.py` класс называется `EnhancedMistralOCRProcessor`.
   - **Результат**: Приложение упадет с ошибкой `ImportError` при запуске.

2. **Отсутствующие зависимости**:
   - Файл `ocr_processor.py` использует библиотеку `easyocr`, но она отсутствует в `requirements.txt`.

---

## 2. План Рефакторинга

### Шаг 1: Исправление кода
1. Переименовать класс в `app.py`.
2. Добавить `easyocr` в `requirements.txt`.

### Шаг 2: Улучшение логики поиска (Regex)
Обновить паттерны поиска номера заявки, сделав их более "всеядными".

### Шаг 3: Оптимизация Предобработки
Сделать предобработку менее агрессивной для LLaVA/Qwen.

---

## 3. Рекомендации по замене LLM (Why Qwen2.5?)

### Почему версии 2.5, а не 3?
По состоянию на январь 2026 года, серия **Qwen3** была частично анонсирована (включая Qwen3-Max и Qwen3-Omni), но **Qwen2.5-VL** остается текущим **SOTA (State-of-the-Art) стандартом для Open Source Vision Language Models**, доступным для локального деплоя с оптимальным соотношением качество/ресурсы.

*   **Qwen2.5-VL (Stable)**: Это флагманская Vision-Language модель. Она специально оптимизирована для извлечения структурированных данных (JSON), понимает документы и таблицы лучше, чем базовые текстовые модели.
*   **Qwen3 (Preview/Early)**: Модели Qwen3 находятся в стадии активного развертывания (в основном как API или тяжелые модели). Qwen2.5-VL проверена, стабильна и имеет отличную поддержку в инструментах вроде Ollama/vLLM.

### Детальное сравнение моделей

| Характеристика | Qwen2.5-VL (7B) | Llama-3.2-Vision (11B) | Mini-CPM-V-2.6 (8B) |
| :--- | :--- | :--- | :--- |
| **Лицензия** | **Apache 2.0**<br>(Свободное коммерческое использование) | **Llama Community License**<br>(Коммерческое использ. с ограничениями) | **Apache 2.0**<br>(Свободное коммерческое использование) |
| **Мин. VRAM (4-bit)** | **8 GB** | **10-12 GB** | **8 GB** |
| **Рек. VRAM (FP16)** | **16 GB** | **24 GB** | **16 GB** |
| **Рек. RAM (Системная)**| **32 GB** | **64 GB** | **32 GB** |
| **Поддержка OCR (RU)** | ⭐⭐⭐⭐⭐ (SOTA) | ⭐⭐⭐⭐ (Хорошая) | ⭐⭐⭐⭐⭐ (Отличная) |
| **Специализация** | Vision-Language, Документы, Агенты | Инструкции + JSON (текст-центрик) | High-Res OCR (мелкий текст) |

### Итоговая рекомендация
**Qwen2.5-VL-7B** — лучший выбор для вашей задачи (обработка актов).
1.  **Специализация на Visual Document Understanding (VDU)**: Она лучше других понимает структуру документов.
2.  **Свободная лицензия (Apache 2.0)**.
3.  **Доступность**: Работает на стандартном GPU (RTX 3060/4060).

---

### Пример улучшенного промпта
```json
{
  "messages": [
    {"role": "system", "content": "You are an expert OCR assistant. Extract data from this Service Act into JSON."},
    {"role": "user", "content": "Analyze this image..."}
  ]
}
```
